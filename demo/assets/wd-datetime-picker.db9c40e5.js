import{d as e,r as a,p as l,q as t,N as u,l as o,o as r,c as i,w as s,n,v as d,i as c,m,a as f,y as v,u as p,e as y,b as _,t as b,F as g,a5 as h,z as k,g as w,h as C,x as V}from"./index-5dc556e1.js";import{v as x,j as $,w as F,z as T,i as B,h as S,H as D,y as P,b as H,l as M,F as L,a as z}from"./page-wraper.eeca02a0.js";import{g as K,_ as j}from"./wd-datetime-picker-view.c831c341.js";const q=z(e({name:"wd-datetime-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{customClass:{default:""},customViewClass:{default:""},customLabelClass:{default:""},customValueClass:{default:""},label:null,placeholder:{default:"请选择"},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},loadingColor:{default:"#4D80F0"},title:null,cancelButtonText:{default:"取消"},confirmButtonText:{default:"完成"},required:{type:Boolean,default:!1},size:null,labelWidth:{default:"33%"},useDefaultSlot:{type:Boolean,default:!1},useLabelSlot:{type:Boolean,default:!1},error:{type:Boolean,default:!1},alignRight:{type:Boolean,default:!1},closeOnClickModal:{type:Boolean,default:!0},safeAreaInsetBottom:{type:Boolean,default:!0},ellipsis:{type:Boolean,default:!1},columnsHeight:{default:217},valueKey:{default:"value"},labelKey:{default:"label"},modelValue:null,type:{default:"datetime"},minDate:{default:new Date((new Date).getFullYear()-10,0,1).getTime()},maxDate:{default:new Date((new Date).getFullYear()+10,11,31).getTime()},minHour:{default:0},maxHour:{default:23},minMinute:{default:0},maxMinute:{default:59},filter:null,formatter:null,displayFormat:null,beforeConfirm:null,displayFormatTabLabel:null,defaultValue:null,zIndex:{default:15},prop:null,rules:{default:()=>[]}},emits:["change","open","toggle","cancel","confirm","update:modelValue"],setup(e,{expose:z,emit:q}){const I=e,O=a(),A=a(),W=a([]),U=a(!1),R=a(!0),Y=a(!1),G=a([]),N=a(""),E=a(""),J=a(!1),Q=a(!1),X=a(!1),{proxy:Z}=V(),ee=x();l((()=>I.modelValue),((e,a)=>{P(e,a)||("array"===F(e)?(Y.value=!0,N.value=T(ie(!0)),E.value=T(ie(!0,!0))):N.value=T(ie()),h((()=>{be(!1,!1,!0)})))}),{deep:!0,immediate:!0}),l((()=>I.displayFormat),(e=>{e&&"function"!==F(e)&&console.error("The type of displayFormat must be Function")}),{deep:!0,immediate:!0}),l((()=>I.filter),(e=>{e&&"function"!==F(e)&&console.error("The type of filter must be Function")}),{deep:!0,immediate:!0}),l((()=>I.formatter),(e=>{e&&"function"!==F(e)&&console.error("The type of formatter must be Function")}),{deep:!0,immediate:!0}),l((()=>I.beforeConfirm),(e=>{e&&"function"!==F(e)&&console.error("The type of beforeConfirm must be Function")}),{deep:!0,immediate:!0}),l((()=>I.displayFormatTabLabel),(e=>{e&&"function"!==F(e)&&console.error("The type of displayFormatTabLabel must be Function")}),{deep:!0,immediate:!0}),l((()=>I.defaultValue),(e=>{"array"===F(e)||Y.value?(N.value=T(ie(!0)),E.value=T(ie(!0,!0))):N.value=T(ie())}),{deep:!0,immediate:!0});const{parent:ae}=$(L),le=t((()=>ae&&I.prop&&ae.errorMessages&&ae.errorMessages[I.prop]?ae.errorMessages[I.prop]:"")),te=t((()=>{let e=!1;if(ae&&ae.props.rules){const a=ae.props.rules;for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&l===I.prop&&Array.isArray(a[l])&&(e=a[l].some((e=>e.required)))}return I.required||I.rules.some((e=>e.required))||e})),ue=e=>{if(!e)return;const{type:a}=I,{startSymbol:l,formatter:t}=e,u=e.correctValue(N.value),o=e.correctValue(E.value),r=l?e.getPickerValue(u,a):e.getPickerValue(o,a),i=l?e.getPickerValue(o,a):e.getPickerValue(u,a),s=e.getOriginColumns();return(n=s).map(((e,a)=>e.values.map(((u,o)=>{const s=function(e,a,l,t,u,o){const{type:r}=I,i=a[l];if("datetime"===r){const a=o[0],l=o[1],r=o[2],s=o[3],n=o[4];if("year"===i.type)return e?t>a:t<a;if("month"===i.type&&u[0]===a)return e?t>l:t<l;if("date"===i.type&&u[0]===a&&u[1]===l)return e?t>r:t<r;if("hour"===i.type&&u[0]===a&&u[1]===l&&u[2]===r)return e?t>s:t<s;if("minute"===i.type&&u[0]===a&&u[1]===l&&u[2]===r&&u[3]===s)return e?t>n:t<n}else if("year-month"===r){const a=o[0],l=o[1];if("year"===i.type)return e?t>a:t<a;if("month"===i.type&&u[0]===a)return e?t>l:t<l}else if("date"===r){const a=o[0],l=o[1],r=o[2];if("year"===i.type)return e?t>a:t<a;if("month"===i.type&&u[0]===a)return e?t>l:t<l;if("date"===i.type&&u[0]===a&&u[1]===l)return e?t>r:t<r}else if("time"===r){const a=o[0],l=o[1];if("hour"===i.type)return e?t>a:t<a;if("minute"===i.type&&u[0]===a)return e?t>l:t<l}return!1}(l,n,a,u,r,i);return{label:t?t(e.type,D(u)):D(u),value:u,disabled:s}}))));var n};function oe(e){let a="before"===e?N.value:E.value,l=[];return a&&(l=K(a,I.type)),l.map((e=>({[I.labelKey]:D(e),[I.valueKey]:e})))}function re(){}function ie(e,a){const{modelValue:l,defaultValue:t}=I;return e?a?l[1]||(t&&B(t)?t[1]:""):l[0]||(t&&B(t)?t[0]:""):S(l||t)?l||t:""}function se(){I.disabled||I.readonly||(q("open"),Y.value?(U.value=!0,R.value=!0,N.value=T(ie(!0,!1)),E.value=T(ie(!0,!0))):(U.value=!0,N.value=T(ie())),be(!0,!1,!0))}function ne(){R.value=!R.value;const e=R.value?O.value:A.value;e.setColumns(e.updateColumns()),q("toggle",R.value?N.value:E.value)}function de({value:e}){N.value=T(e),Y.value?(G.value=[_e(),T(G.value[1])],q("change",{value:[e,E.value]}),O.value&&O.value.setColumns(O.value.updateColumns()),A.value&&A.value.setColumns(A.value.updateColumns())):q("change",{value:N.value})}function ce({value:e}){E.value=T(e),G.value=[T(G.value[0]),_e(1)],q("change",{value:[N.value,e]}),O.value&&O.value.setColumns(O.value.updateColumns()),A.value&&A.value.setColumns(A.value.updateColumns())}function me(){U.value=!1,setTimeout((()=>{Y.value?(N.value=T(ie(!0)),E.value=T(ie(!0,!0))):N.value=T(ie())}),200),q("cancel")}function fe(){if(I.loading||X.value)return;if(J.value)return void(Q.value=!0);const{beforeConfirm:e}=I;e?e(Y.value?[N.value,E.value]:N.value,(e=>{e&&ye()}),Z.$.exposed):ye()}function ve(){J.value=!0}function pe(){J.value=!1,setTimeout((()=>{Q.value&&(Q.value=!1,fe())}),50)}function ye(){if(I.loading||X.value||I.disabled)return void(U.value=!1);const e=Y.value?[N.value,E.value]:N.value;U.value=!1,q("update:modelValue",e),q("confirm",{value:e}),be(!1,!0)}function _e(e=0){if(Y.value){let a=[];return a=0===e?O.value&&O.value.getSelects&&O.value.getSelects()||N.value&&oe("before"):A.value&&A.value.getSelects&&A.value.getSelects()||E.value&&oe("after"),ge(a,!0)}}function be(e=!1,a=!1,l=!1){if(Y.value){const t=l?N.value&&oe("before")||[]:O.value&&O.value.getSelects&&O.value.getSelects()||[],u=l?E.value&&oe("after")||[]:A.value&&A.value.getSelects&&A.value.getSelects()||[];W.value=e?W.value:[I.modelValue[0]||a?ge(t):"",I.modelValue[1]||a?ge(u):""],G.value=[ge(t,!0),ge(u,!0)]}else{const e=l?N.value&&oe("before")||[]:O.value&&O.value.getSelects&&O.value.getSelects()||[];W.value=T(I.modelValue||a?ge(e):"")}}function ge(e,a=!1){if(0===e.length)return"";if(a&&I.displayFormatTabLabel)return I.displayFormatTabLabel(e);if(I.displayFormat)return I.displayFormat(e);if(I.formatter){return(e=>{const a={datetime:["year","month","date","hour","minute"],date:["year","month","date"],time:["hour","minute"],"year-month":["year","month"]};return e.map(((e,l)=>I.formatter(a[I.type][l],e.value)))})(e).join("")}switch(I.type){case"date":return`${e[0].label}-${e[1].label}-${e[2].label}`;case"year-month":return`${e[0].label}-${e[1].label}`;case"time":return`${e[0].label}:${e[1].label}`;case"datetime":return`${e[0].label}-${e[1].label}-${e[2].label} ${e[3].label}:${e[4].label}`}}return u((()=>{const{modelValue:e}=I;"array"===F(e)?(Y.value=!0,N.value=T(ie(!0)),E.value=T(ie(!0,!0))):N.value=T(ie())})),o((()=>{be(!1,!1,!0)})),z({open:function(){se()},close:function(){me()},setLoading:function(e){X.value=e}}),(a,l)=>{const t=c,u=k,o=w(C("wd-icon"),H),h=w(C("wd-datetime-picker-view"),j),V=w(C("wd-popup"),M);return r(),i(t,{class:n(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${d(ee).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`)},{default:s((()=>[m("文案"),f(t,{class:"wd-picker__field",onClick:se},{default:s((()=>[e.useDefaultSlot?v(a.$slots,"default",{key:0},void 0,!0):(r(),i(t,{key:1,class:"wd-picker__cell"},{default:s((()=>[e.label||e.useLabelSlot?(r(),i(t,{key:0,class:n(`wd-picker__label ${e.customLabelClass} ${d(te)?"is-required":""}`),style:p(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:s((()=>[e.label?(r(),y(g,{key:0},[_(b(e.label),1)],64)):v(a.$slots,"label",{key:1},void 0,!0)])),_:3},8,["class","style"])):m("v-if",!0),f(t,{class:"wd-picker__body"},{default:s((()=>[f(t,{class:"wd-picker__value-wraper"},{default:s((()=>[f(t,{class:n(`wd-picker__value ${e.customValueClass}`)},{default:s((()=>[Y.value?(r(),i(t,{key:0},{default:s((()=>[f(u,{class:n(W.value[0]?"":"wd-picker__placeholder")},{default:s((()=>[_(b(W.value[0]?W.value[0]:e.placeholder),1)])),_:1},8,["class"]),_(" 至 "),f(u,{class:n(W.value[1]?"":"wd-picker__placeholder")},{default:s((()=>[_(b(W.value[1]?W.value[1]:e.placeholder),1)])),_:1},8,["class"])])),_:1})):(r(),i(t,{key:1,class:n(W.value?"":"wd-picker__placeholder")},{default:s((()=>[_(b(W.value?W.value:e.placeholder),1)])),_:1},8,["class"]))])),_:1},8,["class"]),e.disabled||e.readonly?m("v-if",!0):(r(),i(o,{key:0,"custom-class":"wd-picker__arrow",name:"arrow-right"}))])),_:1}),d(le)?(r(),i(t,{key:0,class:"wd-picker__error-message"},{default:s((()=>[_(b(d(le)),1)])),_:1})):m("v-if",!0)])),_:1})])),_:3}))])),_:3}),m("弹出层，picker-view 在隐藏时修改值，会触发多次change事件，从而导致所有列选中第一项，因此picker在关闭时不隐藏 "),f(V,{modelValue:U.value,"onUpdate:modelValue":l[2]||(l[2]=e=>U.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"safe-area-inset-bottom":e.safeAreaInsetBottom,"z-index":e.zIndex,onClose:me,"custom-class":"wd-picker__popup"},{default:s((()=>[f(t,{class:"wd-picker__wraper"},{default:s((()=>[m("toolBar"),f(t,{class:"wd-picker__toolbar",onTouchmove:re},{default:s((()=>[m("取消按钮"),f(t,{class:"wd-picker__action wd-picker__action--cancel",onClick:me},{default:s((()=>[_(b(e.cancelButtonText),1)])),_:1}),m("标题"),e.title?(r(),i(t,{key:0,class:"wd-picker__title"},{default:s((()=>[_(b(e.title),1)])),_:1})):m("v-if",!0),m("确定按钮"),f(t,{class:n("wd-picker__action "+(e.loading||X.value?"is-loading":"")),onClick:fe},{default:s((()=>[_(b(e.confirmButtonText),1)])),_:1},8,["class"])])),_:1}),m(" 区域选择tab展示 "),Y.value?(r(),i(t,{key:0,class:"wd-picker__region-tabs"},{default:s((()=>[f(t,{class:n(`wd-picker__region ${R.value?"is-active":""} `),onClick:ne},{default:s((()=>[f(t,null,{default:s((()=>[_("开始时间")])),_:1}),f(t,{class:"wd-picker__region-time"},{default:s((()=>[_(b(G.value[0]),1)])),_:1})])),_:1},8,["class"]),f(t,{class:n("wd-picker__region "+(R.value?"":"is-active")),onClick:ne},{default:s((()=>[f(t,null,{default:s((()=>[_("结束时间")])),_:1}),f(t,{class:"wd-picker__region-time"},{default:s((()=>[_(b(G.value[1]),1)])),_:1})])),_:1},8,["class"])])),_:1})):m("v-if",!0),m("datetimePickerView"),f(t,{class:n(R.value?"wd-picker__show":"wd-picker__hidden")},{default:s((()=>[f(h,{"custom-class":e.customViewClass,ref_key:"datetimePickerView",ref:O,type:e.type,modelValue:N.value,"onUpdate:modelValue":l[0]||(l[0]=e=>N.value=e),loading:e.loading||X.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,formatter:e.formatter,filter:e.filter,"column-formatter":"array"===d(F)(e.modelValue)?ue:void 0,"max-hour":e.maxHour,"min-hour":e.minHour,"max-date":e.maxDate,"min-date":e.minDate,"max-minute":e.maxMinute,"min-minute":e.minMinute,"start-symbol":!0,onChange:de,onPickstart:ve,onPickend:pe},null,8,["custom-class","type","modelValue","loading","loading-color","columns-height","value-key","label-key","formatter","filter","column-formatter","max-hour","min-hour","max-date","min-date","max-minute","min-minute"])])),_:1},8,["class"]),f(t,{class:n(R.value?"wd-picker__hidden":"wd-picker__show")},{default:s((()=>[f(h,{"custom-class":e.customViewClass,ref_key:"datetimePickerView1",ref:A,type:e.type,modelValue:E.value,"onUpdate:modelValue":l[1]||(l[1]=e=>E.value=e),loading:e.loading||X.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,formatter:e.formatter,filter:e.filter,"column-formatter":"array"===d(F)(e.modelValue)?ue:void 0,"max-hour":e.maxHour,"min-hour":e.minHour,"max-date":e.maxDate,"min-date":e.minDate,"max-minute":e.maxMinute,"min-minute":e.minMinute,"start-symbol":!1,onChange:ce,onPickstart:ve,onPickend:pe},null,8,["custom-class","type","modelValue","loading","loading-color","columns-height","value-key","label-key","formatter","filter","column-formatter","max-hour","min-hour","max-date","min-date","max-minute","min-minute"])])),_:1},8,["class"])])),_:1})])),_:1},8,["modelValue","close-on-click-modal","safe-area-inset-bottom","z-index"])])),_:3},8,["class"])}}}),[["__scopeId","data-v-9beaf09d"]]);export{q as _};
