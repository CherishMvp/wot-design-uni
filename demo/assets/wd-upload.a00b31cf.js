import{L as e,d as s,r as a,p as o,g as l,h as t,o as i,c as n,w as u,m as r,e as c,F as d,f,n as m,a as p,b as v,t as y,y as h,j as _,i as g,z as w,ad as b,A as C,H as k,ae as z}from"./index-5dc556e1.js";import{y as T,G as x,w as F,n as L,b as P,h as D,a as I}from"./page-wraper.eeca02a0.js";const S=I(s({name:"wd-upload",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{customClass:{default:""},customEvokeClass:{default:""},customPreviewClass:{default:""},multiple:{type:Boolean,default:!1},accept:{default:"image"},sizeType:{default:()=>["original","compressed"]},sourceType:{default:()=>["album","camera"]},header:{default:()=>({})},name:{default:"file"},formData:{default:()=>({})},action:null,fileList:{default:()=>[]},statusKey:{default:"status"},maxSize:{default:Number.MAX_VALUE},limit:null,showLimitNum:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},useDefaultSlot:{type:Boolean,default:!1},loadingType:{default:"ring"},loadingColor:{default:"#ffffff"},loadingSize:{default:"24px"},beforePreview:null,onPreviewFail:null,beforeRemove:null,beforeUpload:null,beforeChoose:null,buildFormData:null},emits:["fail","change","success","progress","oversize","chooseerror","remove"],setup(s,{emit:I}){const S=s,U=a([]);function E(e,s,a){const{statusKey:o}=S,l=U.value.findIndex((e=>e.uid===s.uid));l>-1&&(U.value[l][o]="fail",U.value[l].error=e.message,U.value[l].response=e,I("fail",{error:e,file:s,formData:a}))}function A(e,s){const{action:a,name:o,header:l={},accept:t}=S;z({url:a,header:l,name:o,fileName:o,fileType:t,formData:s,filePath:e.url,success(a){200===a.statusCode?function(e,s,a){const{statusKey:o}=S,l=U.value.findIndex((e=>e.uid===s.uid));l>-1&&(U.value[l][o]="success",U.value[l].response=e.data,I("change",{fileList:U.value}),I("success",{file:s,fileList:U.value,formData:a}))}(a,e,s):E(a,e,s)},fail(a){E(a,e,s)}}).onProgressUpdate((s=>{!function(e,s){const a=U.value.findIndex((e=>e.uid===s.uid));a>-1&&(U.value[a].percent=e.progress,I("progress",{response:e,file:s}))}(s,e)}))}function B(){const{multiple:s,maxSize:a,accept:o,sizeType:l,limit:t,sourceType:i,beforeUpload:n}=S;"image"===o&&function({multiple:s,sizeType:a,sourceType:o,maxCount:l}){return new Promise(((t,i)=>{e({count:s?Math.min(l,9):1,sizeType:a,sourceType:o,success:t,fail:i})}))}({multiple:s,sizeType:l,sourceType:i,maxCount:t?t-U.value.length:9}).then((e=>{let o=null;o=Array.prototype.slice.call(e.tempFiles),s||(o=o.slice(0,1));const l=e=>{e.forEach((async e=>{var s;D(e.size)||(e.size=await(s=e.path,new Promise(((e,a)=>{k({src:s,success:s=>{e(s.height*s.width)},fail:()=>{a(0)}})})))),e.size<=a?function(e){const s={uid:x.id++,name:e.name||"",status:"loading",size:e.size,url:e.path,action:S.action,percent:0};U.value.push(s);const{buildFormData:a,formData:o={}}=S;a?a({file:s,formData:o,resolve:e=>{e&&A(s,e)}}):A(s,o)}(e):I("oversize",{file:e})}))};n?2===n.length?n(o,(e=>{e&&l(o)})):n({files:o,fileList:U.value,resolve:e=>{e&&l(o)}}):l(o)})).catch((e=>{I("chooseerror",{error:e})}))}function K(){if(S.disabled)return;const{beforeChoose:e}=S;e?2===e.length?e(U.value,(e=>{e&&B()})):e({fileList:U.value,resolve:e=>{e&&B()}}):B()}function N(e,s){U.value.splice(U.value.findIndex((s=>s.uid===e.uid)),1),I("change",{fileList:U.value}),I("remove",{file:e})}function R(e,s){const{onPreviewFail:a}=S;b({urls:s,current:s[e],fail(){a?2===a.length?a(e,s):a({index:e,imgList:s}):C({title:"预览图片失败",icon:"none"})}})}return o((()=>S.fileList),(e=>{const{statusKey:s}=S;if(T(e,U.value))return;const a=e.map((e=>(e.uid=x.id++,e[s]=e[s]||"success",e.size=e.size||"",e.action=S.action||"",e.response=e.response||"",e)));U.value=a}),{deep:!0,immediate:!0}),o((()=>S.limit),(e=>{e&&e<U.value.length&&console.error("[wot-design]Error: props limit must less than fileList.length")}),{deep:!0,immediate:!0}),o((()=>S.beforePreview),(e=>{e&&"function"!==F(e)&&"asyncfunction"!==F(e)&&console.error("The type of beforePreview must be Function")}),{deep:!0,immediate:!0}),o((()=>S.onPreviewFail),(e=>{e&&"function"!==F(e)&&"asyncfunction"!==F(e)&&console.error("The type of onPreviewFail must be Function")}),{deep:!0,immediate:!0}),o((()=>S.beforeRemove),(e=>{e&&"function"!==F(e)&&"asyncfunction"!==F(e)&&console.error("The type of beforeRemove must be Function")}),{deep:!0,immediate:!0}),o((()=>S.beforeUpload),(e=>{e&&"function"!==F(e)&&"asyncfunction"!==F(e)&&console.error("The type of beforeUpload must be Function")}),{deep:!0,immediate:!0}),o((()=>S.beforeChoose),(e=>{e&&"function"!==F(e)&&"asyncfunction"!==F(e)&&console.error("The type of beforeChoose must be Function")}),{deep:!0,immediate:!0}),o((()=>S.buildFormData),(e=>{e&&"function"!==F(e)&&"asyncfunction"!==F(e)&&console.error("The type of buildFormData must be Function")}),{deep:!0,immediate:!0}),(e,a)=>{const o=_,b=g,C=l(t("wd-loading"),L),k=w,z=l(t("wd-icon"),P);return i(),n(b,{class:m(["wd-upload",s.customClass])},{default:u((()=>[r(" 预览列表 "),(i(!0),c(d,null,f(U.value,((e,a)=>(i(),n(b,{class:m(["wd-upload__preview",s.customPreviewClass]),key:a},{default:u((()=>[r(" 成功时展示图片 "),p(b,{class:"wd-upload__status-content"},{default:u((()=>[p(o,{src:e.url,mode:"aspectFit",class:"wd-upload__picture",onClick:e=>function(e){const{beforePreview:s}=S,a=U.value.map((e=>e.url));s?2===s.length?s({index:e,lists:a},(s=>{s&&R(e,a)})):s({index:e,imgList:a,resolve:s=>{s&&R(e,a)}}):R(e,a)}(a)},null,8,["src","onClick"])])),_:2},1024),"success"!==e.status?(i(),n(b,{key:0,class:"wd-upload__mask wd-upload__status-content"},{default:u((()=>[r(" loading时展示loading图标和进度 "),"loading"===e.status?(i(),n(b,{key:0,class:"wd-upload__status-content"},{default:u((()=>[p(C,{size:24,color:s.loadingColor},null,8,["color"]),p(k,{class:"wd-upload__progress-txt"},{default:u((()=>[v(y(e.percent)+"%",1)])),_:2},1024)])),_:2},1024)):r("v-if",!0),r(" 失败时展示失败图标以及失败信息 "),"fail"===e.status?(i(),n(b,{key:1,class:"wd-upload__status-content"},{default:u((()=>[p(z,{name:"close-outline","custom-class":"wd-upload__icon"}),p(k,{class:"wd-upload__progress-txt"},{default:u((()=>[v(y(e.error||"上传失败"),1)])),_:2},1024)])),_:2},1024)):r("v-if",!0)])),_:2},1024)):r("v-if",!0),r(" 上传状态为上传中时不展示移除按钮 "),"loading"===e.status||s.disabled?r("v-if",!0):(i(),n(z,{key:1,name:"error-fill","custom-class":"wd-upload__close",onClick:e=>function(e){const{beforeRemove:s}=S,a=parseInt(e),o=U.value[a];s?3===s.length?s(o,U.value,(e=>{e&&N(o)})):s({file:o,index:a,fileList:U.value,resolve:e=>{e&&N(o)}}):N(o)}(a)},null,8,["onClick"]))])),_:2},1032,["class"])))),128)),p(b,{onClick:K},{default:u((()=>[s.useDefaultSlot?h(e.$slots,"default",{key:0},void 0,!0):r("v-if",!0),r(" 唤起项 "),s.useDefaultSlot||s.limit&&!(U.value.length<s.limit)?r("v-if",!0):(i(),n(b,{key:1,class:m(["wd-upload__evoke",s.disabled?"is-disabled":"",s.customEvokeClass])},{default:u((()=>[r(" 唤起项图标 "),p(z,{class:"wd-upload__evoke-icon",name:"fill-camera"}),r(" 有限制个数时确认是否展示限制个数 "),s.limit&&s.showLimitNum?(i(),n(b,{key:0,class:"wd-upload__evoke-num"},{default:u((()=>[v("（"+y(U.value.length)+"/"+y(s.limit)+"）",1)])),_:1})):r("v-if",!0)])),_:1},8,["class"]))])),_:3})])),_:3},8,["class"])}}}),[["__scopeId","data-v-883c256f"]]);export{S as _};
