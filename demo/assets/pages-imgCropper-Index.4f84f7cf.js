import{d as e,r as a,G as l,p as t,q as u,o,e as i,m as s,c,w as n,a as r,n as v,u as d,v as m,b as p,t as h,F as f,H as g,I as w,i as _,j as x,J as y,g as b,h as M,x as S,K as T,L as $}from"./index-5dc556e1.js";import{o as I,q as k,b as C,a as H,_ as N}from"./page-wraper.eeca02a0.js";import{_ as V}from"./wd-button.4cb1c8d4.js";import{_ as q}from"./wd-img.9a3ff35e.js";import{_ as W}from"./demo-block.069a2303.js";const j=e({name:"wd-img-cropper",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{customClass:{default:""},modelValue:{type:Boolean,default:!1},cancelButtonText:{default:"取消"},confirmButtonText:{default:"完成"},disabledRotate:{type:Boolean,default:!1},fileType:{default:"png"},quality:{default:1},exportScale:{default:2},imgSrc:{default:""},imgWidth:{default:""},imgHeight:{default:""},maxScale:{default:3}},emits:["imgloaded","imgloaderror","cancel","confirm","update:modelValue"],setup(e,{expose:$,emit:H}){const N=e;let q=null,W=null,j=!0,B=null,F=null;const X=.85,Y=a(0),z=a(!1),P=a(0),A=a(0),R=a(0),G=a(0),L=a(20),O=a(0),D=a(0),E=a(""),J=a(""),K=a(2),U=a(1),Q=a(l().windowWidth/2),Z=a(l().windowHeight/2*X),ee=a(null),ae=a(l()),le=a(!0),te=a([{x:"",y:""},{x:"",y:""}]),ue=a(""),oe=a(null),{proxy:ie}=S();t((()=>N.modelValue),(e=>{if(e){B=N.imgWidth,F=N.imgHeight,ae.value=l();const e=ae.value.windowWidth-2*L.value;R.value=e,G.value=e,D.value=(ae.value.windowHeight*X-e)/2,O.value=L.value,K.value=N.exportScale,J.value=e,E.value=e,function(){if(B&&"string"==typeof B&&-1!==B.indexOf("%")){const e=B.replace("%","");B=ae.value.windowWidth/100*Number(e),P.value=B}else B&&"number"==typeof B&&(P.value=B);if(F&&"string"==typeof F&&-1!==F.indexOf("%")){const e=N.imgHeight.replace("%","");F=ae.value.windowHeight/100*Number(e),P.value=F}else F&&"number"==typeof F&&(P.value=Number(B))}(),oe.value||(oe.value=w("wd-img-cropper-canvas",ie)),N.imgSrc&&ve()}else re()}),{deep:!0,immediate:!0}),t((()=>N.imgSrc),(e=>{e&&ve()}),{deep:!0,immediate:!0}),t((()=>Y.value),(e=>{e%90&&(Y.value=90*Math.round(e/90))}),{deep:!0,immediate:!0}),t((()=>z.value),(e=>{q&&clearTimeout(q),e&&(q=setTimeout((()=>{ne(!1),clearTimeout(q)}),300))}),{deep:!0,immediate:!0});const se=u((()=>I({position:"absolute",right:0,width:"56px","border-radius":"16px","font-size":"16px"}))),ce=u((()=>{const e={width:P.value?k(P.value):"auto",height:A.value?k(A.value):"auto",transform:`translate(${k(Q.value-P.value/2)}, ${k(Z.value-A.value/2)}) scale(${U.value}) rotate(${Y.value}deg)`,"transition-duration":(z.value?.4:0)+"s"};return I(e)}));function ne(e){z.value=e}function re(){const{windowHeight:e,windowWidth:a}=l();U.value=1,Y.value=0,Q.value=a/2,Z.value=e/2*X}function ve(){N.imgSrc&&g({src:N.imgSrc,success:e=>{ee.value=e,function(){let e=P.value,a=A.value;F||B?F&&!B?e=ee.value.width/ee.value.height*Number(F):(!F&&B||F&&B)&&(a=ee.value.height/ee.value.width*Number(B)):(e=ee.value.width,a=ee.value.height,P.value/A.value>R.value/G.value?(a=G.value,e=ee.value.width/ee.value.height*G.value):(e=R.value,a=ee.value.height/ee.value.width*R.value));P.value=e,A.value=a}(),re()},fail:()=>{}})}function de(e){const a=e||U.value;let l=Q.value,t=Z.value,u=P.value,o=A.value;Y.value/90%2&&(u=A.value,o=P.value),l=u*a/2+O.value>=l?l:u*U.value/2+O.value,l=O.value+R.value-u*a/2<=l?l:O.value+R.value-u*a/2,t=o*a/2+D.value>=t?t:o*a/2+D.value,t=D.value+G.value-o*a/2<=t?t:D.value+G.value-o*a/2,U.value=a,Z.value=t,Q.value=l}function me(e){if(le.value=!1,1===e.touches.length)te.value[0]={x:e.touches[0].clientX-Q.value,y:e.touches[0].clientY-Z.value};else{const a=Math.abs(e.touches[1].clientX-e.touches[0].clientX),l=Math.abs(e.touches[1].clientY-e.touches[0].clientY);ue.value=Math.sqrt(Math.pow(a,2)+Math.pow(l,2))}}function pe(e){if(!le.value&&j)if("android"===ae.value.platform?(W&&clearTimeout(W),W=setTimeout((()=>{j=!0}),25)):!j&&(j=!0),1===e.touches.length){const{x:a,y:l}=te.value[0],t=e.touches[0].clientX-Number(a),u=e.touches[0].clientY-Number(l);Q.value=t,Z.value=u,de()}else{const a=Math.abs(e.touches[1].clientX-e.touches[0].clientX),l=Math.abs(e.touches[1].clientY-e.touches[0].clientY),t=Math.sqrt(Math.pow(a,2)+Math.pow(l,2)),u=U.value*(t/Number(ue.value));U.value=Math.min(u,N.maxScale),function(){let e=P.value,a=A.value,l=U.value;Y.value/90%2&&(e=A.value,a=P.value),e*l<R.value&&(l=R.value/e),a*l<G.value&&(l=G.value/a),de(l)}(),ue.value=Math.sqrt(Math.pow(a,2)+Math.pow(l,2))}}function he(){le.value=!0}function fe(e){H("imgloaded",e)}function ge(e){H("imgloaderror",e)}function we(){var e;(e=Y.value-90)&&!N.disabledRotate&&(ne(!0),Y.value=e,de())}function _e(){H("cancel"),H("update:modelValue",!1)}function xe(e){!function(){if(!N.imgSrc)return;const e=()=>{const e=P.value*U.value*N.exportScale,a=A.value*U.value*N.exportScale,l=Q.value-O.value,t=Z.value-D.value;oe.value.translate(l*N.exportScale,t*N.exportScale),N.disabledRotate||oe.value.rotate(Y.value*Math.PI/180),oe.value.drawImage(N.imgSrc,-e/2,-a/2,e,a),oe.value.restore(),oe.value.draw(!1,(()=>{!function(){const{fileType:e,quality:a,exportScale:l}=N;try{T({width:R.value*l,height:Math.round(G.value*l),destWidth:R.value*l,destHeight:Math.round(G.value*l),fileType:e,quality:a,canvasId:"wd-img-cropper-canvas",success:e=>{H("confirm",{tempFilePath:e.tempFilePath,width:R.value*l,height:G.value*l})},complete:()=>{H("update:modelValue",!1)}},ie)}catch(t){console.log(t)}}()}))};J.value=G.value,E.value=R.value,e()}()}function ye(){}return $({revertIsAnimation:ne}),(a,l)=>{const t=_,u=x,g=y,w=b(M("wd-icon"),C),S=b(M("wd-button"),V);return o(),i(f,null,[s(" 绘制的图片canvas "),e.modelValue?(o(),c(t,{key:0,id:"wd-img-cropper",class:v(`wd-img-cropper ${e.customClass}`),onTouchmove:ye},{default:n((()=>[s(" 展示在用户面前的裁剪框 "),r(t,{class:"wd-img-cropper__wrapper"},{default:n((()=>[s(" 画出裁剪框 "),r(t,{class:"wd-img-cropper__cut"},{default:n((()=>[s(" 上方阴影块 "),r(t,{class:v("wd-img-cropper__cut--top "+(le.value?"":"is-hightlight")),style:d(`height: ${D.value}px;`)},null,8,["class","style"]),r(t,{class:"wd-img-cropper__cut--middle"},{default:n((()=>[s(" 左侧阴影块 "),r(t,{class:v("wd-img-cropper__cut--left "+(le.value?"":"is-hightlight")),style:d(`width: ${O.value}px; height: ${R.value}px;`)},null,8,["class","style"]),s(" 裁剪框 "),r(t,{class:"wd-img-cropper__cut--body",style:d(`width: ${R.value}px; height: ${G.value}px;`)},{default:n((()=>[s(" 内部网格线 "),r(t,{class:"is-gridlines-x"}),r(t,{class:"is-gridlines-y"}),s(" 裁剪窗体四个对角 "),r(t,{class:"is-left-top"}),r(t,{class:"is-left-bottom"}),r(t,{class:"is-right-top"}),r(t,{class:"is-right-bottom"})])),_:1},8,["style"]),s(" 右侧阴影块 "),r(t,{class:v("wd-img-cropper__cut--right "+(le.value?"":"is-hightlight"))},null,8,["class"])])),_:1}),s(" 底部阴影块 "),r(t,{class:v("wd-img-cropper__cut--bottom "+(le.value?"":"is-hightlight"))},null,8,["class"])])),_:1}),s(" 展示的传过来的图片: 控制图片的旋转角度(rotate)、缩放程度(imgScale)、移动位置(translate) "),r(u,{prop:z.value,"change:prop":a.animation?a.animation.setAnimation:"",class:"wd-img-cropper__img",src:e.imgSrc,style:d(m(ce)),"lazy-load":!1,onTouchstart:me,onTouchmove:pe,onTouchend:he,onError:ge,onLoad:fe},null,8,["prop","change:prop","src","style"])])),_:1}),s(" 绘制的图片canvas "),r(g,{"canvas-id":"wd-img-cropper-canvas",id:"wd-img-cropper-canvas",class:"wd-img-cropper__canvas","disable-scroll":!0,style:d(`width: ${Number(E.value)*K.value}px; height: ${Number(J.value)*K.value}px;`)},null,8,["style"]),s(" 下方按钮 "),r(t,{class:"wd-img-cropper__footer"},{default:n((()=>[e.disabledRotate?s("v-if",!0):(o(),c(w,{key:0,name:"rotate",size:"24px",color:"#fff","data-eventsync":"true",onClick:we})),r(t,{class:"wd-img-cropper__footer--button"},{default:n((()=>[r(t,{class:"is-cancel",onClick:_e},{default:n((()=>[p(h(e.cancelButtonText),1)])),_:1}),r(S,{size:"small","custom-style":m(se),onClick:xe},{default:n((()=>[p(h(e.confirmButtonText),1)])),_:1},8,["custom-style"])])),_:1})])),_:1})])),_:1},8,["class"])):s("v-if",!0)],2112)}}});const B={setAnimation:function(e,a,l){if(e)var t=l.setTimeout((function(){l.callMethod("revertIsAnimation",!1),l.clearTimeout(t)}),300)}},F=e=>{e.$wxs||(e.$wxs=[]),e.$wxs.push("animation"),e.mixins||(e.mixins=[]),e.mixins.push({beforeCreate(){this.animation=B}})};F(j);const X=H(j,[["__scopeId","data-v-fc072ecc"]]),Y=H(e({__name:"Index",setup(e){const l=a(""),t=a(""),u=a(!1);function i(){$({count:1,success:e=>{const a=e.tempFilePaths[0];l.value=a,u.value=!0}})}function v(e){const{tempFilePath:a}=e;t.value=a}function d(e){console.log("加载失败",e)}function m(e){console.log("加载成功",e)}function h(e){console.log("取消",e)}return(e,a)=>{const f=b(M("wd-img-cropper"),X),g=b(M("wd-icon"),C),w=_,x=b(M("wd-img"),q),y=b(M("demo-block"),W),S=b(M("page-wraper"),N);return o(),c(S,null,{default:n((()=>[r(y,{title:"基本用法",style:{"text-align":"center"}},{default:n((()=>[r(f,{id:"wd-img-cropper",modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),"img-src":l.value,onConfirm:v,onCancel:h,onImgloaderror:d,onImgloaded:m},null,8,["modelValue","img-src"]),r(w,{class:"profile"},{default:n((()=>[t.value?s("v-if",!0):(o(),c(w,{key:0,class:"img",onClick:i},{default:n((()=>[r(g,{name:"fill-camera","custom-class":"img-icon"})])),_:1})),t.value?(o(),c(x,{key:1,round:"",width:"200px",height:"200px",src:t.value,mode:"aspectFit","custom-class":"profile-img",onClick:i},null,8,["src"])):s("v-if",!0),r(w,{style:{"font-size":"14px"}},{default:n((()=>[p("点击上传头像")])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-f9018b80"]]);export{Y as default};
