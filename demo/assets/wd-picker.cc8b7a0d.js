import{d as e,r as l,q as a,p as o,a5 as s,l as t,N as u,g as n,h as i,o as r,c,w as d,m as p,a as f,y as m,n as v,v as y,u as g,e as _,F as k,b,t as h,i as w,x as C}from"./index-5dc556e1.js";import{v as V,w as x,h as B,j as S,z as $,B as K,b as I,l as F,F as z,a as T}from"./page-wraper.eeca02a0.js";import{f as q,_ as A}from"./wd-picker-view.3b2bd9b1.js";const j=T(e({name:"wd-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{customClass:{default:""},customLabelClass:{default:""},customValueClass:{default:""},customViewClass:{default:""},label:null,placeholder:{default:"请选择"},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},loadingColor:{default:"#4D80F0"},title:null,cancelButtonText:{default:"取消"},confirmButtonText:{default:"完成"},required:{type:Boolean,default:!1},size:null,labelWidth:null,useDefaultSlot:{type:Boolean,default:!1},useLabelSlot:{type:Boolean,default:!1},error:{type:Boolean,default:!1},alignRight:{type:Boolean,default:!1},beforeConfirm:null,closeOnClickModal:{type:Boolean,default:!0},safeAreaInsetBottom:{type:Boolean,default:!0},ellipsis:{type:Boolean,default:!1},columnsHeight:{default:217},valueKey:{default:"value"},labelKey:{default:"label"},modelValue:{default:""},columns:{default:()=>[]},columnChange:null,displayFormat:null,zIndex:{default:15},prop:null,rules:{default:()=>[]}},emits:["confirm","open","cancel","update:modelValue"],setup(e,{expose:T,emit:j}){const L=e,M=l(null),O=V(),W=l(!1),D=l(!1),H=l(""),P=l(""),R=l([]),U=l([]),E=l(!1),G=l(!1),N=a((()=>L.loading||W.value));o((()=>L.displayFormat),(e=>{e&&"function"!==x(e)&&console.error("The type of displayFormat must be Function"),M.value&&M.value.selectedIndex&&0!==M.value.selectedIndex.length&&(L.modelValue?te(M.value.getSelects()):H.value="")}),{immediate:!0,deep:!0}),o((()=>L.modelValue),(e=>{P.value=e,B(e)?M.value&&M.value.getSelects?s((()=>{te(M.value.getSelects())})):te(Z(L.modelValue)):H.value=""}),{deep:!0,immediate:!0}),o((()=>L.columns),(e=>{R.value=e,U.value=e,L.modelValue?M.value&&M.value.getSelects?s((()=>{te(M.value.getSelects())})):te(Z(L.modelValue)):H.value=""}),{deep:!0,immediate:!0}),o((()=>L.columnChange),(e=>{e&&"function"!==x(e)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{parent:J}=S(z),Q=a((()=>J&&L.prop&&J.errorMessages&&J.errorMessages[L.prop]?J.errorMessages[L.prop]:"")),X=a((()=>{let e=!1;if(J&&J.props.rules){const l=J.props.rules;for(const a in l)Object.prototype.hasOwnProperty.call(l,a)&&a===L.prop&&Array.isArray(l[a])&&(e=l[a].some((e=>e.required)))}return L.required||L.rules.some((e=>e.required))||e})),{proxy:Y}=C();function Z(e){const l=q(L.columns,L.valueKey,L.labelKey);if(0===L.columns.length)return;(""===e||null==e||"array"===x(e)&&0===e.length)&&(e=l.map((e=>e[0][L.valueKey])));const a=x(e);if(-1===["string","number","boolean","array"].indexOf(a))return[];0===(e=(e=e instanceof Array?e:[e]).slice(0,l.length)).length&&(e=l.map((()=>0)));let o=[];e.forEach(((e,a)=>{let s=l[a].findIndex((l=>l[L.valueKey].toString()===e.toString()));s=-1===s?0:s,o.push(s)}));const s=o.map(((e,a)=>l[a][e]));return 1===s.length?s[0]:s}function ee(){L.disabled||L.readonly||(j("open"),D.value=!0,P.value=L.modelValue,R.value=U.value)}function le(){D.value=!1,j("cancel")}function ae(){if(N.value)return;if(E.value)return void(G.value=!0);const{beforeConfirm:e}=L;e&&"function"===x(e)?e(P.value,(e=>{e&&oe()}),Y.$.exposed):oe()}function oe(){if(N.value||L.disabled)return void(D.value=!1);const e=M.value.getSelects(),l=M.value.getValues(),a=M.value.getColumnsData();D.value=!1,U.value=$(a),j("update:modelValue",l),te(e),j("confirm",{value:l,selectedItems:e})}function se({value:e}){P.value=e}function te(e){if(e instanceof Array&&!e.length||!e)return;const{valueKey:l,labelKey:a}=L;H.value=(L.displayFormat||K)(e,{valueKey:l,labelKey:a})}function ue(){}function ne(){E.value=!0}function ie(){E.value=!1,G.value&&(G.value=!1,ae())}return t((()=>{L.modelValue&&te(Z(L.modelValue)),L.modelValue&&M.value&&M.value.getSelects&&te(M.value.getSelects())})),u((()=>{R.value=$(L.columns),U.value=$(L.columns)})),T({close:function(){le()},open:function(){ee()},setLoading:function(e){W.value=e}}),(l,a)=>{const o=w,s=n(i("wd-icon"),I),t=n(i("wd-picker-view"),A),u=n(i("wd-popup"),F);return r(),c(o,{class:v(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${y(O).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`)},{default:d((()=>[p("文案"),f(o,{class:"wd-picker__field",onClick:ee},{default:d((()=>[e.useDefaultSlot?m(l.$slots,"default",{key:0},void 0,!0):(r(),c(o,{key:1,class:"wd-picker__cell"},{default:d((()=>[e.label||e.useLabelSlot?(r(),c(o,{key:0,class:v(`wd-picker__label ${e.customLabelClass}  ${y(X)?"is-required":""}`),style:g(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:d((()=>[e.label?(r(),_(k,{key:0},[b(h(e.label),1)],64)):m(l.$slots,"label",{key:1},void 0,!0)])),_:3},8,["class","style"])):p("v-if",!0),f(o,{class:"wd-picker__body"},{default:d((()=>[f(o,{class:"wd-picker__value-wraper"},{default:d((()=>[f(o,{class:v(`wd-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${H.value?"":"wd-picker__placeholder"}`)},{default:d((()=>[b(h(H.value?H.value:e.placeholder),1)])),_:1},8,["class"]),e.disabled||e.readonly?p("v-if",!0):(r(),c(s,{key:0,"custom-class":"wd-picker__arrow",name:"arrow-right"}))])),_:1}),y(Q)?(r(),c(o,{key:0,class:"wd-picker__error-message"},{default:d((()=>[b(h(y(Q)),1)])),_:1})):p("v-if",!0)])),_:1})])),_:3}))])),_:3}),p("弹出层，picker-view 在隐藏时修改值，会触发多次change事件，从而导致所有列选中第一项，因此picker在关闭时不隐藏 "),f(u,{modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=e=>D.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,onClose:le,"custom-class":"wd-picker__popup"},{default:d((()=>[f(o,{class:"wd-picker__wraper"},{default:d((()=>[p("toolBar"),f(o,{class:"wd-picker__toolbar",onTouchmove:ue},{default:d((()=>[p("取消按钮"),f(o,{class:"wd-picker__action wd-picker__action--cancel",onClick:le},{default:d((()=>[b(h(e.cancelButtonText),1)])),_:1}),p("标题"),e.title?(r(),c(o,{key:0,class:"wd-picker__title"},{default:d((()=>[b(h(e.title),1)])),_:1})):p("v-if",!0),p("确定按钮"),f(o,{class:v("wd-picker__action "+(y(N)?"is-loading":"")),onClick:ae},{default:d((()=>[b(h(e.confirmButtonText),1)])),_:1},8,["class"])])),_:1}),p("pickerView"),f(t,{ref_key:"pickerViewWd",ref:M,"custom-class":e.customViewClass,modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value=e),columns:R.value,loading:y(N),"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,onChange:se,onPickstart:ne,onPickend:ie,"column-change":e.columnChange},null,8,["custom-class","modelValue","columns","loading","loading-color","columns-height","value-key","label-key","column-change"])])),_:1})])),_:1},8,["modelValue","close-on-click-modal","z-index","safe-area-inset-bottom"])])),_:3},8,["class"])}}}),[["__scopeId","data-v-9a122e62"]]);export{j as _};
