import{w as e,y as a,z as l,n,A as t,a as o}from"./page-wraper.eeca02a0.js";import{d as u,r as s,p as i,g as r,h as c,o as d,c as m,w as v,a as f,m as p,u as h,e as g,F as y,f as w,n as b,b as k,t as _,x,a5 as C,i as K,a8 as $,a9 as I}from"./index-5dc556e1.js";function V(a,l,n){let t=a instanceof Array?a:[a];const o=new Set(a.map(e));if(1!==o.size&&o.has("object"))throw Error("The columns are correct");a[0]instanceof Array||(t=[t]);return t.map((a=>a.map((a=>{if("object"!==e(a))return{[l]:a,[n]:a};if(!a.hasOwnProperty(l)&&!a.hasOwnProperty(n))throw Error("Can't find valueKey and labelKey in columns");return a.hasOwnProperty(n)||(a[n]=a[l]),a.hasOwnProperty(l)||(a[l]=a[n]),a}))))}const P=o(u({name:"wd-picker-view",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{customClass:{default:""},loading:{type:Boolean,default:!1},loadingColor:{default:"#4D80F0"},columnsHeight:{default:217},valueKey:{default:"value"},labelKey:{default:"label"},modelValue:{type:[String,Number,Boolean,Array]},columns:{default:()=>[]},columnChange:null},emits:["change","pickstart","pickend","update:modelValue"],setup(o,{expose:u,emit:P}){const S=o,A=s([]),E=s(35),O=s([]),j=s([]);i((()=>S.modelValue),((e,l)=>{a(l,e)||H(e)}),{deep:!0,immediate:!0}),i((()=>S.columns),(e=>{A.value=V(e,S.valueKey,S.labelKey),H(S.modelValue)}),{deep:!0,immediate:!0}),i((()=>O.value),(e=>{a(e,j.value)||a(N(),S.modelValue)||z(0)}),{deep:!0,immediate:!0}),i((()=>S.columnChange),(a=>{a&&"function"!==e(a)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{proxy:D}=x();function H(a){if(0===S.columns.length)return;(""===a||null==a||"array"===e(a)&&0===a.length)&&(a=A.value.map((e=>e[0][S.valueKey])));const n=e(a),t=["string","number","boolean","array"];-1===t.indexOf(n)&&console.error(`value must be one of ${t.toString()}`),0===A.value.length&&(A.value=V(S.columns,S.valueKey,S.labelKey)),0===(a=(a=a instanceof Array?a:[a]).slice(0,A.value.length)).length&&(a=A.value.map((()=>0)));let o=l(O.value);a.forEach(((e,a)=>{let l=A.value[a].findIndex((a=>a[S.valueKey].toString()===e.toString()));l=-1===l?0:l,o=T(a,l)})),O.value=o.slice(0,a.length)}function T(e,a){const n=A.value[e];if(!n||!n[a])throw Error(`The value to select with Col:${e} Row:${a} is correct`);const t=l(O.value);if(n[a].disabled){const l=n.slice(0,a).reverse().findIndex((e=>!e.disabled)),o=n.slice(a+1).findIndex((e=>!e.disabled));-1!==l?t[e]=a-1-l:-1!==o?t[e]=a+1+o:void 0===t[e]&&(t[e]=0)}else t[e]=a;return O.value=l(t),O.value}function F({detail:{value:e}}){const a=function(e){e=e.slice(0,A.value.length);const a=l(O.value);let n=l(O.value);e.forEach(((e,l)=>{(e=t(e,0,A.value[l].length-1))!==a[l]&&(n=T(l,e))})),O.value=n,j.value=a;const o=function(e,a){if(!e||!a)return;const l=e.findIndex(((e,l)=>e!==a[l]));return l}(n,a);if(-1===o)return;const u=n[o];return 1===n.length?u:o}(e=e.map((e=>Number(e||0))));O.value=l(e),C((()=>{S.columnChange?S.columnChange.length<4?(S.columnChange(D.$.exposed,B(),a),z(a)):S.columnChange(D.$.exposed,B(),a,(()=>{z(a)})):z(a)}))}function z(e){const l=N();a(l,S.modelValue)||(P("update:modelValue",l),setTimeout((()=>{P("change",{picker:D.$.exposed,value:l,index:e})}),0))}function B(){const e=O.value.map(((e,a)=>A.value[a][e]));return 1===e.length?e[0]:e}function N(){const{valueKey:e}=S,a=O.value.map(((a,l)=>A.value[l][a][e]));return 1===a.length?a[0]:a}function G(){P("pickstart")}function L(){P("pickend")}return u({getSelects:B,getValues:N,setColumnData:function(e,a,l=0){O.value=T(e,l),A.value[e]=V(a,S.valueKey,S.labelKey).reduce(((e,a)=>e.concat(a)),[])},getColumnsData:function(){return A.value.slice(0)},getColumnData:function(e){return A.value[e]},getColumnIndex:function(e){return O.value[e]},getLabels:function(){const{labelKey:e}=S;return O.value.map(((a,l)=>A.value[l][a][e]))},selectedIndex:O}),(e,a)=>{const l=r(c("wd-loading"),n),t=K,u=$,s=I;return d(),m(t,{class:b(`wd-picker-view ${o.customClass}`)},{default:v((()=>[o.loading?(d(),m(t,{key:0,class:"wd-picker-view__loading"},{default:v((()=>[f(l,{color:o.loadingColor},null,8,["color"])])),_:1})):p("v-if",!0),f(t,{style:h(`height: ${o.columnsHeight-20}px;`)},{default:v((()=>[f(s,{"mask-class":"wd-picker-view__mask","indicator-class":"wd-picker-view__roller","indicator-style":`height: ${E.value}px;`,style:h(`height: ${o.columnsHeight-20}px;`),value:O.value,onChange:F,onPickstart:G,onPickend:L},{default:v((()=>[(d(!0),g(y,null,w(A.value,((e,a)=>(d(),m(u,{key:a,class:"wd-picker-view-column"},{default:v((()=>[(d(!0),g(y,null,w(e,((e,l)=>(d(),m(t,{key:l,class:b(`wd-picker-view-column__item ${e.disabled?"wd-picker-view-column__item--disabled":""}  ${O.value[a]==l?"wd-picker-view-column__item--active":""}`),style:h(`line-height: ${E.value}px;`)},{default:v((()=>[k(_(e[o.labelKey]),1)])),_:2},1032,["class","style"])))),128))])),_:2},1024)))),128))])),_:1},8,["indicator-style","style","value"])])),_:1},8,["style"])])),_:1},8,["class"])}}}),[["__scopeId","data-v-0f4873c8"]]);export{P as _,V as f};
