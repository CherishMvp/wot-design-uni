import{d as e,r as t,P as s,q as o,g as a,h as l,o as i,c as u,w as n,m as d,a as c,n as r,u as v,v as f,y as p,i as h,x as b,a4 as y,O as w,N as x}from"./index-5dc556e1.js";import{_ as m}from"./wd-resize.d376c0ad.js";import{q as g,o as _,g as k,a as $}from"./page-wraper.eeca02a0.js";const C=$(e({name:"wd-sticky",options:{addGlobalClass:!0,styleIsolation:"shared"},props:{customStyle:{default:""},customClass:{default:""},zIndex:{default:1},offsetTop:{default:0}},setup(e,{expose:w}){const x=e,$=t(!1),C=t("absolute"),z=t(0),T=t(0),I=t(0),R=t([]),P=t(""),j=s("box-height",null)||t(0),M=s("observerForChild",null),{proxy:q}=b(),B=b(),F=o((()=>{const e={"z-index":x.zIndex,height:g(T.value),width:g(I.value)};return $.value||(e.position="relative"),`${_(e)};${x.customStyle}`})),G=o((()=>{const e={"z-index":x.zIndex,height:g(T.value),width:g(I.value)};return $.value||(e.position="relative"),`${_(e)};`})),S=o((()=>{const e={position:C.value,top:g(z.value)};return _(e)})),V=o((()=>{let e=0;return e=44,44+x.offsetTop}));function E(e){I.value=e.width,T.value=e.height,function(){if(0===T.value&&0===I.value)return;const e=V.value+T.value;(function(){for(;0!==R.value.length;)R.value.pop().disconnect()})(),function(){const e=y(B);return R.value.push(e),e}().relativeToViewport({top:-e}).observe(".wd-sticky",N),k(".wd-sticky",!1,q).then((t=>{t.bottom<=e&&N({boundingClientRect:t})}))}(),M&&M(q)}function N({boundingClientRect:e}){if(M&&T.value>=j.value)return C.value="absolute",void(z.value=0);e.top<=V.value?(P.value="sticky",$.value=!1,C.value="fixed",z.value=V.value):e.top>V.value&&(P.value="normal",$.value=!1,C.value="absolute",z.value=0)}return w({setPosition:function(e,t,s){$.value=e,C.value=t,z.value=s},openBox:$,position:C,top:z,height:T,width:I,state:P,offsetTop:V.value}),(e,t)=>{const s=a(l("wd-resize"),m),o=h;return i(),u(o,{style:v(`${f(F)};display: inline-block;`)},{default:n((()=>[d("强制设置高宽，防止元素坍塌"),d("在使用 wd-sticky-box 时，某些情况下 wd-sticky__container 的 'position：absolute' 需要相对于 wd-sticky-box"),c(o,{class:r(`wd-sticky ${x.customClass}`),style:v(f(G))},{default:n((()=>[d("吸顶容器"),c(o,{class:"wd-sticky__container",style:v(f(S))},{default:n((()=>[d("监听元素尺寸变化"),c(s,{onResize:E,"custom-style":"display: inline-block;"},{default:n((()=>[d("需要吸顶的内容"),p(e.$slots,"default",{},void 0,!0)])),_:3})])),_:3},8,["style"])])),_:3},8,["class","style"])])),_:3},8,["style"])}}}),[["__scopeId","data-v-23f6c633"]]),z=$(e({name:"wd-sticky-box",options:{addGlobalClass:!0,styleIsolation:"shared"},props:{customClass:{default:""}},setup(e){const s=e,o=t(new Map),d=t(0),v=t(0),f=[],{proxy:g}=b(),_=b();function $(e){v.value=e.width,d.value=e.height;const t=o.value;o.value=new Map;for(const[s]of t){C(f.find((e=>e.$.uid===s)))}t.forEach((e=>{e.disconnect()})),t.clear()}function C(e){f.find((t=>t.$.uid===e.$.uid))||f.push(e),function(e){const t=o.value.get(e.$.uid);t&&(t.disconnect(),o.value.delete(e.$.uid))}(e);const t=function(e){const t=y(_);return o.value.set(e.$.uid,t),t}(e),s=e.$.exposed,a=s.height.value+s.offsetTop;d.value<=s.height.value&&s.setPosition(!1,"absolute",0),t.relativeToViewport({top:-a}).observe(".wd-sticky-box",(e=>{z(s,e)})),k(".wd-sticky-box",!1,g).then((e=>{e.bottom<=a&&z(s,{boundingClientRect:e})}))}function z(e,{boundingClientRect:t}){const s=e.height.value+e.offsetTop;if(t.bottom<=s)e.setPosition(!0,"absolute",t.height-e.height.value);else if(t.top<=s&&t.bottom>s){if("normal"===e.state.value)return;e.setPosition(!1,"fixed",e.offsetTop)}}return w("box-height",d),w("box-width",v),w("observerForChild",C),x((()=>{o.value=new Map})),(e,t)=>{const o=a(l("wd-resize"),m),d=h;return i(),u(d,{style:{position:"relative"}},{default:n((()=>[c(d,{class:r(`wd-sticky-box ${s.customClass}`)},{default:n((()=>[c(o,{onResize:$},{default:n((()=>[p(e.$slots,"default",{},void 0,!0)])),_:3})])),_:3},8,["class"])])),_:3})}}}),[["__scopeId","data-v-5c501e93"]]);export{C as _,z as a};
